module zeroriscy_debug_unit
    parameter REG_ADDR_WIDTH 5
    net addr_q ('reg', (14, 0))
    net regfile_wreq_o ('output', 0)
    net exc_cause_i ('input', (5, 0))
    net debug_halt_i ('input', 0)
    net dbg_req_o ('output reg', 0)
    net settings_q ('reg', (['-', 'DBG_SETS_W', 1], 0))
    net debug_halted_o ('output reg', 0)
    net rdata_sel_n ('reg', (2, 0))
    net rdata_sel_q ('reg', (2, 0))
    net settings_n ('reg', (['-', 'DBG_SETS_W', 1], 0))
    net settings_o ('output', (['-', 'DBG_SETS_W', 1], 0))
    net stall_o ('output reg', 0)
    net csr_rdata_i ('input', (31, 0))
    net dbg_ack_i ('input', 0)
    net jump_req_n ('reg', 0)
    net clk ('input', 0)
    net debug_addr_i ('input', (14, 0))
    net pc_if_i ('input', (31, 0))
    net debug_gnt_o ('output reg', 0)
    net jump_req_o ('output', 0)
    net regfile_raddr_o ('output', (['-', 'REG_ADDR_WIDTH', 1], 0))
    net npc_int ('wire', (31, 0))
    net debug_we_i ('input', 0)
    net regfile_rdata_i ('input', (31, 0))
    net ppc_int ('wire', (31, 0))
    net debug_req_i ('input', 0)
    net rst_n ('input', 0)
    net trap_i ('input', 0)
    net stall_cs ('reg', (1, 0))
    net state_n ('reg', (0, 0))
    net csr_req_q ('reg', 0)
    net regfile_wreq ('reg', 0)
    net debug_rvalid_o ('output reg', 0)
    net ssth_clear ('reg', 0)
    net pc_id_i ('input', (31, 0))
    net dbg_halt ('reg', 0)
    net debug_wdata_i ('input', (31, 0))
    net dbg_rdata ('reg', (31, 0))
    net dbg_cause_q ('reg', (5, 0))
    net csr_req_o ('output', 0)
    net csr_req_n ('reg', 0)
    net state_q ('reg', (0, 0))
    net regfile_wdata_o ('output', (31, 0))
    net regfile_rreq_n ('reg', 0)
    net regfile_rreq_o ('output', 0)
    net regfile_waddr_o ('output', (['-', 'REG_ADDR_WIDTH', 1], 0))
    net csr_wdata_o ('output', (31, 0))
    net csr_addr_o ('output', (11, 0))
    net dbg_cause_n ('reg', (5, 0))
    net dbg_ssth_n ('reg', 0)
    net instr_valid_id_i ('input', 0)
    net jump_addr_o ('output', (31, 0))
    net stall_ns ('reg', (1, 0))
    net dbg_resume ('reg', 0)
    net dbg_ssth_q ('reg', 0)
    net jump_req_q ('reg', 0)
    net wdata_q ('reg', (31, 0))
    net csr_we_o ('output reg', 0)
    net debug_resume_i ('input', 0)
    net sleeping_i ('input', 0)
    net debug_rdata_o ('output reg', (31, 0))
    net regfile_rreq_q ('reg', 0)
    assign ('ppc_int', 'pc_id_i', '', '')
    assign ('npc_int', 'pc_if_i', '', '')
    assign ('regfile_rreq_o', 'regfile_rreq_q', '', '')
    assign ('regfile_raddr_o', ['subbus', 'addr_q', [6, 2]], '', '')
    assign ('regfile_wreq_o', 'regfile_wreq', '', '')
    assign ('regfile_waddr_o', ['subbus', 'debug_addr_i', [6, 2]], '', '')
    assign ('regfile_wdata_o', 'debug_wdata_i', '', '')
    assign ('csr_req_o', 'csr_req_q', '', '')
    assign ('csr_addr_o', ['subbus', 'addr_q', [13, 2]], '', '')
    assign ('csr_wdata_o', 'wdata_q', '', '')
    assign ('jump_req_o', 'jump_req_q', '', '')
    assign ('jump_addr_o', 'wdata_q', '', '')
    assign ('settings_o', 'settings_q', '', '')
    always ['*', ['list', ['=', 'rdata_sel_n', 'RD_NONE'], ['=', 'state_n', 'FIRST'], ['=', 'debug_gnt_o', ['bin', '1', '0']], ['=', 'regfile_rreq_n', ['bin', '1', '0']], ['=', 'regfile_wreq', ['bin', '1', '0']], ['=', 'csr_req_n', ['bin', '1', '0']], ['=', 'csr_we_o', ['bin', '1', '0']], ['=', 'jump_req_n', ['bin', '1', '0']], ['=', 'dbg_resume', ['bin', '1', '0']], ['=', 'dbg_halt', ['bin', '1', '0']], ['=', 'settings_n', 'settings_q'], ['=', 'ssth_clear', ['bin', '1', '0']], ['if', 'debug_req_i', ['list', ['ifelse', 'debug_we_i', ['list', ['ifelse', ['subbit', 'debug_addr_i', 14], ['list', ['ifelse', ['==', 'state_q', 'FIRST'], ['list', ['=', 'debug_gnt_o', ['bin', '1', '0']], ['=', 'state_n', 'SECOND'], ['if', 'debug_halted_o', ['list', ['=', 'csr_req_n', ['bin', '1', '1']]]]], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['=', 'state_n', 'FIRST'], ['=', 'csr_we_o', ['bin', '1', '1']]]]], ['list', ['case', ['subbus', 'debug_addr_i', (13, 8)], [[[['bin', '6', '00_0000']], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['case', ['subbus', 'debug_addr_i', (6, 2)], [[[['bin', '5', '0_0000']], ['list', ['ifelse', ['subbit', 'debug_wdata_i', 16], ['list', ['if', ['~', 'debug_halted_o'], ['list', ['=', 'dbg_halt', ['bin', '1', '1']]]]], ['list', ['if', 'debug_halted_o', ['list', ['=', 'dbg_resume', ['bin', '1', '1']]]]]], ['=', ['subbit', 'settings_n', 'DBG_SETS_SSTE'], ['subbit', 'debug_wdata_i', 0]]]], [[['bin', '5', '0_0001']], ['list', ['=', 'ssth_clear', ['subbit', 'debug_wdata_i', 0]]]], [[['bin', '5', '0_0010']], ['list', ['=', ['subbit', 'settings_n', 'DBG_SETS_ECALL'], ['subbit', 'debug_wdata_i', 11]], ['=', ['subbit', 'settings_n', 'DBG_SETS_ELSU'], ['|', ['subbit', 'debug_wdata_i', 7], ['subbit', 'debug_wdata_i', 5]]], ['=', ['subbit', 'settings_n', 'DBG_SETS_EBRK'], ['subbit', 'debug_wdata_i', 3]], ['=', ['subbit', 'settings_n', 'DBG_SETS_EILL'], ['subbit', 'debug_wdata_i', 2]]]], ['default', ['empty_begin_end']]]]]], [[['bin', '6', '10_0000']], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['if', 'debug_halted_o', ['list', ['case', ['subbus', 'debug_addr_i', (6, 2)], [[[['bin', '5', '0_0000']], ['=', 'jump_req_n', ['bin', '1', '1']]], ['default', ['empty_begin_end']]]]]]]], [[['bin', '6', '00_0100']], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['if', 'debug_halted_o', ['list', ['=', 'regfile_wreq', ['bin', '1', '1']]]]]], ['default', ['=', 'debug_gnt_o', ['bin', '1', '1']]]]]]]], ['list', ['ifelse', ['subbit', 'debug_addr_i', 14], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['if', 'debug_halted_o', ['list', ['=', 'csr_req_n', ['bin', '1', '1']], ['=', 'rdata_sel_n', 'RD_CSR']]]], ['list', ['case', ['subbus', 'debug_addr_i', (13, 8)], [[[['bin', '6', '00_0000']], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['=', 'rdata_sel_n', 'RD_DBGA']]], [[['bin', '6', '10_0000']], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['=', 'rdata_sel_n', 'RD_DBGS']]], [[['bin', '6', '00_0100']], ['list', ['=', 'debug_gnt_o', ['bin', '1', '1']], ['if', 'debug_halted_o', ['list', ['=', 'regfile_rreq_n', ['bin', '1', '1']], ['=', 'rdata_sel_n', 'RD_GPR']]]]], ['default', ['=', 'debug_gnt_o', ['bin', '1', '1']]]]]]]]]]]], 'always']
    always ['*', ['list', ['=', 'dbg_rdata', ['dig', 32, '0']], ['case', 'rdata_sel_q', [[['RD_DBGA'], ['list', ['case', ['subbus', 'addr_q', (6, 2)], [[[['hex', '5', '00']], ['=', ['subbus', 'dbg_rdata', (31, 0)], ['curly', ['bin', '15', '0'], 'debug_halted_o', ['bin', '15', '0'], ['subbit', 'settings_q', 'DBG_SETS_SSTE']]]], [[['hex', '5', '01']], ['=', ['subbus', 'dbg_rdata', (31, 0)], ['curly', ['bin', '15', '0'], 'sleeping_i', ['bin', '15', '0'], 'dbg_ssth_q']]], [[['hex', '5', '02']], ['list', ['=', ['subbus', 'dbg_rdata', (31, 16)], ['dig', 32, '0']], ['=', ['subbus', 'dbg_rdata', (15, 12)], ['dig', 32, '0']], ['=', ['subbit', 'dbg_rdata', 11], ['subbit', 'settings_q', 'DBG_SETS_ECALL']], ['=', ['subbus', 'dbg_rdata', (10, 8)], ['dig', 32, '0']], ['=', ['subbit', 'dbg_rdata', 7], ['subbit', 'settings_q', 'DBG_SETS_ELSU']], ['=', ['subbit', 'dbg_rdata', 6], ['bin', '1', '0']], ['=', ['subbit', 'dbg_rdata', 5], ['subbit', 'settings_q', 'DBG_SETS_ELSU']], ['=', ['subbit', 'dbg_rdata', 4], ['bin', '1', '0']], ['=', ['subbit', 'dbg_rdata', 3], ['subbit', 'settings_q', 'DBG_SETS_EBRK']], ['=', ['subbit', 'dbg_rdata', 2], ['subbit', 'settings_q', 'DBG_SETS_EILL']], ['=', ['subbus', 'dbg_rdata', (1, 0)], ['dig', 32, '0']]]], [[['hex', '5', '03']], ['=', 'dbg_rdata', ['curly', ['subbit', 'dbg_cause_q', 5], ['bin', '26', '0'], ['subbus', 'dbg_cause_q', [4, 0]]]]], [[['hex', '5', '10']], ['=', 'dbg_rdata', ['dig', 32, '0']]], [[['hex', '5', '12']], ['=', 'dbg_rdata', ['dig', 32, '0']]], [[['hex', '5', '14']], ['=', 'dbg_rdata', ['dig', 32, '0']]], [[['hex', '5', '16']], ['=', 'dbg_rdata', ['dig', 32, '0']]], [[['hex', '5', '18']], ['=', 'dbg_rdata', ['dig', 32, '0']]], [[['hex', '5', '1A']], ['=', 'dbg_rdata', ['dig', 32, '0']]], [[['hex', '5', '1C']], ['=', 'dbg_rdata', ['dig', 32, '0']]], [[['hex', '5', '1E']], ['=', 'dbg_rdata', ['dig', 32, '0']]], ['default', ['empty_begin_end']]]]]], [['RD_DBGS'], ['list', ['case', ['subbus', 'addr_q', (2, 2)], [[[['bin', '1', '0']], ['=', 'dbg_rdata', 'npc_int']], [[['bin', '1', '1']], ['=', 'dbg_rdata', 'ppc_int']], ['default', ['empty_begin_end']]]]]], ['default', ['empty_begin_end']]]]], 'always']
    always ['*', ['list', ['=', 'debug_rdata_o', ['dig', 32, '0']], ['case', 'rdata_sel_q', [[['RD_CSR'], ['=', 'debug_rdata_o', 'csr_rdata_i']], [['RD_GPR'], ['=', 'debug_rdata_o', 'regfile_rdata_i']], [['RD_DBGA'], ['=', 'debug_rdata_o', 'dbg_rdata']], [['RD_DBGS'], ['=', 'debug_rdata_o', 'dbg_rdata']], ['default', ['empty_begin_end']]]]], 'always']
    always [['list', ['edge', 'posedge', 'clk'], ['edge', 'negedge', 'rst_n']], ['list', ['ifelse', ['~', 'rst_n'], ['list', ['<=', 'debug_rvalid_o', ['bin', '1', '0']]], ['list', ['<=', 'debug_rvalid_o', 'debug_gnt_o']]]], 'always']
    always ['*', ['list', ['=', 'stall_ns', 'stall_cs'], ['=', 'dbg_req_o', ['bin', '1', '0']], ['=', 'stall_o', ['bin', '1', '0']], ['=', 'debug_halted_o', ['bin', '1', '0']], ['=', 'dbg_cause_n', 'dbg_cause_q'], ['=', 'dbg_ssth_n', 'dbg_ssth_q'], ['case', 'stall_cs', [[['RUNNING'], ['list', ['=', 'dbg_ssth_n', ['bin', '1', '0']], ['if', ['|', ['|', 'dbg_halt', 'debug_halt_i'], 'trap_i'], ['list', ['=', 'dbg_req_o', ['bin', '1', '1']], ['=', 'stall_ns', 'HALT_REQ'], ['ifelse', 'trap_i', ['list', ['if', ['subbit', 'settings_q', 'DBG_SETS_SSTE'], ['=', 'dbg_ssth_n', ['bin', '1', '1']]], ['=', 'dbg_cause_n', 'exc_cause_i']], ['list', ['=', 'dbg_cause_n', 'DBG_CAUSE_HALT']]]]]]], [['HALT_REQ'], ['list', ['=', 'dbg_req_o', ['bin', '1', '1']], ['if', 'dbg_ack_i', ['=', 'stall_ns', 'HALT']], ['if', ['|', 'dbg_resume', 'debug_resume_i'], ['=', 'stall_ns', 'RUNNING']]]], [['HALT'], ['list', ['=', 'stall_o', ['bin', '1', '1']], ['=', 'debug_halted_o', ['bin', '1', '1']], ['if', ['|', 'dbg_resume', 'debug_resume_i'], ['list', ['=', 'stall_ns', 'RUNNING'], ['=', 'stall_o', ['bin', '1', '0']]]]]]]], ['if', 'ssth_clear', ['=', 'dbg_ssth_n', ['bin', '1', '0']]]], 'always']
    always [['list', ['edge', 'posedge', 'clk'], ['edge', 'negedge', 'rst_n']], ['list', ['ifelse', ['~', 'rst_n'], ['list', ['<=', 'stall_cs', 'RUNNING'], ['<=', 'dbg_cause_q', 'DBG_CAUSE_HALT'], ['<=', 'dbg_ssth_q', ['bin', '1', '0']]], ['list', ['<=', 'stall_cs', 'stall_ns'], ['<=', 'dbg_cause_q', 'dbg_cause_n'], ['<=', 'dbg_ssth_q', 'dbg_ssth_n']]]], 'always']
    always [['list', ['edge', 'posedge', 'clk'], ['edge', 'negedge', 'rst_n']], ['list', ['ifelse', ['~', 'rst_n'], ['list', ['<=', 'addr_q', ['dig', 32, '0']], ['<=', 'wdata_q', ['dig', 32, '0']], ['<=', 'state_q', 'FIRST'], ['<=', 'rdata_sel_q', 'RD_NONE'], ['<=', 'regfile_rreq_q', ['bin', '1', '0']], ['<=', 'csr_req_q', ['bin', '1', '0']], ['<=', 'jump_req_q', ['bin', '1', '0']], ['<=', 'settings_q', ['bin', '1', '0']]], ['list', ['<=', 'settings_q', 'settings_n'], ['if', 'debug_req_i', ['list', ['<=', 'addr_q', 'debug_addr_i'], ['<=', 'wdata_q', 'debug_wdata_i'], ['<=', 'state_q', 'state_n']]], ['if', ['|', 'debug_req_i', 'debug_rvalid_o'], ['list', ['<=', 'regfile_rreq_q', 'regfile_rreq_n'], ['<=', 'csr_req_q', 'csr_req_n'], ['<=', 'jump_req_q', 'jump_req_n'], ['<=', 'rdata_sel_q', 'rdata_sel_n']]]]]], 'always']
endmodule
